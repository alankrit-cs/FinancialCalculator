<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>SIP Calculator</title>

  <style>
    :root{
      --bg:#edf2ff;
      --muted:#5f6f94;
      --text:#18213a;
      --accent:#4a6bff;
      --accent2:#12a66c;
      --border:rgba(44,68,120,.20);
      --shadow: 0 20px 48px rgba(61,84,137,.20);
      --radius:16px;
      --fieldbg: rgba(255,255,255,.78);
      --panelTop: rgba(255,255,255,.84);
      --panelBottom: rgba(239,245,255,.72);
      --panelHead: rgba(236,243,255,.78);
      --pillBg: rgba(18,166,108,.14);
      --pillBorder: rgba(18,166,108,.28);
      --pillText: #0f7e53;
      --glowA: rgba(74,107,255,.24);
      --glowB: rgba(18,166,108,.18);
      --focus: rgba(74,107,255,.18);
      --highlightBase: rgba(246,250,255,.94);
      --prefix: rgba(52,77,128,.66);
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: radial-gradient(1200px 600px at 20% 0%, var(--glowA), transparent 60%),
                  radial-gradient(900px 500px at 90% 10%, var(--glowB), transparent 55%),
                  var(--bg);
      color:var(--text);
      min-height:100vh;
      padding: 28px 14px;
      transition: background .25s ease, color .25s ease;
    }
    body.dark{
      --bg:#0b1220;
      --muted:#9fb0d0;
      --text:#eaf0ff;
      --accent:#5b7cfa;
      --accent2:#22c55e;
      --border:rgba(255,255,255,.10);
      --shadow: 0 18px 50px rgba(0,0,0,.45);
      --fieldbg: rgba(16,31,54,.55);
      --panelTop: rgba(255,255,255,.06);
      --panelBottom: rgba(255,255,255,.03);
      --panelHead: rgba(0,0,0,.18);
      --pillBg: rgba(34,197,94,.16);
      --pillBorder: rgba(34,197,94,.32);
      --pillText: rgba(220,255,235,.95);
      --glowA: rgba(91,124,250,.25);
      --glowB: rgba(34,197,94,.18);
      --focus: rgba(91,124,250,.15);
      --highlightBase: rgba(16,31,54,.55);
      --prefix: rgba(234,240,255,.75);
    }
    .wrap{ max-width: 980px; margin: 0 auto; display:grid; gap:16px; }
    header{ padding: 6px 4px 0; }
    .topBar{ display:flex; align-items:center; justify-content:space-between; gap:12px; }
    h1{ font-size: 28px; margin:0; letter-spacing:.2px; }
    .subtitle{ color: var(--muted); font-size: 14px; margin-top:6px; }
    .themeToggle{
      border: 1px solid var(--border);
      background: var(--fieldbg);
      color: var(--text);
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 10px 12px;
      min-width: 118px;
      justify-content: center;
    }
    .themeToggle .icon{ font-size: 15px; }

    .grid{
      display:grid;
      grid-template-columns: 380px 1fr;
      gap:14px;
      align-items:start;
    }
    @media (max-width:1020px){
      .grid{ grid-template-columns:1fr; }
    }

    .panel{
      background: linear-gradient(180deg, var(--panelTop), var(--panelBottom));
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .panelHead{
      padding: 14px 16px;
      border-bottom: 1px solid var(--border);
      background: var(--panelHead);
      font-weight: 800;
      letter-spacing:.2px;
    }
    .panelBody{ padding: 16px; }

    .form{ display:grid; gap: 12px; }

    .line{ display:grid; gap:12px; }
    .line.two{ grid-template-columns: 1fr 1fr; }
    @media (max-width: 520px){
      .line.two{ grid-template-columns: 1fr; }
    }
    .panelBody{ padding:14px; }

    .form{ display:grid; gap:10px; }
    .line{ display:grid; gap:10px; }
    .line.two{ grid-template-columns:1fr 1fr; }
    @media (max-width:560px){ .line.two{ grid-template-columns:1fr; } }
    .field{ display:grid; gap:6px; }
    .field label{ color:var(--muted); font-size:12px; font-weight:700; }
    .inputWrap{ position:relative; }
    .prefix{
      position:absolute; left: 12px; top: 50%;
      transform: translateY(-50%);
      color: var(--prefix);
      font-size: 14px; pointer-events:none;
    }

    input, select{
      width:100%;
      padding: 12px 12px 12px 36px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: var(--fieldbg);
      color: var(--text);
      font-size: 15px;
      outline:none;
    }
    select{ padding-left: 12px; }
    input:focus, select:focus{
      border-color: rgba(91,124,250,.65);
      box-shadow: 0 0 0 4px var(--focus);
    }
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }

    .actions{
      display:flex;
      gap:10px;
      margin-top: 6px;
      flex-wrap:wrap;
    }
    button{
      border:0;
      border-radius: 12px;
      padding: 12px 14px;
      font-weight: 800;
      cursor:pointer;
      font-size: 14px;
      transition: transform .05s ease, filter .15s ease;
    }
    button:active{ transform: translateY(1px); }
    .btnPrimary{
      background: linear-gradient(135deg, rgba(91,124,250,1), rgba(91,124,250,.75));
      color:white;
    }
    .btnGhost{
      background: var(--fieldbg);
      color: var(--text);
      border: 1px solid var(--border);
    }

    .disclaimer{
      margin-top: 10px;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.4;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px dashed var(--border);
      background: var(--panelBottom);
    }

    .resultStack{ display:grid; gap: 12px; }
    .highlight{
      background: radial-gradient(700px 220px at 15% 0%, rgba(91,124,250,.35), transparent 55%),
                  radial-gradient(700px 240px at 90% 40%, rgba(34,197,94,.22), transparent 60%),
                  var(--highlightBase);
      border: 1px solid color-mix(in srgb, var(--accent) 45%, transparent);
      border-radius: 16px;
      padding: 14px 14px 12px;
    }
    .pill{
      display:inline-flex; align-items:center;
      padding: 4px 10px; border-radius: 999px;
      background: var(--pillBg);
      border: 1px solid var(--pillBorder);
      color: var(--pillText);
      font-weight: 900; font-size: 12px;
      gap:6px;
    }
    .metric .k{ color:var(--muted); font-size:11px; text-transform:uppercase; letter-spacing:.1em; font-weight:800; }
    .metric .v{ font-size:27px; font-weight:900; margin-top:5px; }
    .metric .s{ font-size:13px; color:var(--muted); margin-top:6px; }
    .chartsGrid{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    @media (max-width:1060px){ .chartsGrid{ grid-template-columns:1fr; } }
    .chartCard{
      background:var(--field);
      border:1px solid var(--border);
      border-radius:14px;
      padding:10px;
      min-height:220px;
      display:grid;
      grid-template-rows:auto 1fr;
      gap:8px;
    }
    .mini{
      background: var(--fieldbg);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 12px;
    }
    .donut::after{
      content:"";
      position:absolute;
      inset:18px;
      border-radius:50%;
      background:var(--field);
      border:1px solid var(--border);
    }
    .legend{ display:grid; gap:8px; }
    .legendItem{ display:flex; align-items:center; justify-content:space-between; font-size:13px; color:var(--text); }
    .dot{ width:10px; height:10px; border-radius:50%; display:inline-block; margin-right:8px; }
    .empty{ color:var(--muted); font-size:13px; }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="topBar">
        <h1>SIP Calculator</h1>
        <button class="themeToggle" id="themeToggle" type="button" onclick="toggleTheme()">
          <span class="icon" id="themeIcon">üåô</span>
          <span id="themeLabel">Dark mode</span>
        </button>
      </div>
    </header>

    <div class="grid">
      <section class="panel">
        <div class="panelHead">Inputs</div>
        <div class="panelBody">
          <div class="form">

            <div class="line">
              <div class="field">
                <label for="lumpSum">Lump Sum</label>
                <div class="inputWrap">
                  <div class="prefix">‚Çπ</div>
                  <input type="number" id="lumpSum" value="0" min="0" inputmode="decimal" />
                </div>
              </div>
            </div>

            <div class="line two">
              <div class="field">
                <label for="depositAmount">Regular Deposit Amount</label>
                <div class="inputWrap">
                  <div class="prefix">‚Çπ</div>
                  <input type="number" id="depositAmount" placeholder="e.g., 2000" min="0" inputmode="decimal" />
                </div>
              </div>
              <div class="field">
                <label for="depositFreq">Deposit Frequency</label>
                <select id="depositFreq">
                  <option value="monthly" selected>Monthly</option>
                  <option value="quarterly">Quarterly</option>
                  <option value="halfYearly">Half Yearly</option>
                  <option value="yearly">Yearly</option>
                </select>
              </div>
            </div>

            <div class="line two">
              <div class="field">
                <label for="stepUpValue">Increase/Decrease Deposit Every Year</label>
                <div class="inputWrap">
                  <div class="prefix">¬±</div>
                  <input type="number" id="stepUpValue" value="0" inputmode="decimal" />
                </div>
              </div>
              <div class="field">
                <label for="stepUpUnit">Step-up Unit</label>
                <select id="stepUpUnit">
                  <option value="rupees">Rupees</option>
                  <option value="percent" selected>Percentage (%)</option>
                </select>
              </div>
            </div>

            <div class="line two">
              <div class="field">
                <label for="termValue">Term</label>
                <div class="inputWrap">
                  <div class="prefix">#</div>
                  <input type="number" id="termValue" placeholder="e.g., 20" min="0" inputmode="numeric" />
                </div>
              </div>
              <div class="field">
                <label for="termUnit">Term Unit</label>
                <select id="termUnit">
                  <option value="years" selected>Years</option>
                  <option value="months">Months</option>
                </select>
              </div>
            </div>

            <div class="line">
              <div class="field">
                <label for="rate">Expected Return (%)</label>
                <div class="inputWrap">
                  <div class="prefix">%</div>
                  <input type="number" id="rate" placeholder="e.g., 12" min="0" inputmode="decimal" />
                </div>
              </div>
            </div>

            <div class="actions">
              <button class="btnPrimary" onclick="calculateSIP()">Calculate + Graph</button>
              <button class="btnGhost" onclick="resetForm()">Reset</button>
            </div>
            <div class="empty">Tip: graphs update instantly after calculate.</div>
          </div>
        </div>
      </section>

      <section class="panel">
        <div class="panelHead">Results</div>
        <div class="panelBody">
          <div id="result" class="resultStack hidden">
            <div class="highlight">
              <span class="pill">‚≠ê Maturity Amount</span>
              <div class="moneyBig" id="maturityText">Rs. 0.00</div>
              <div class="mutedLine" id="investedHint">Total invested: Rs. 0.00</div>
            </div>

        <div class="chartsGrid">
          <div class="chartCard">
            <div class="chartTitle">Investment vs Portfolio Value</div>
            <canvas id="lineChart" width="580" height="170"></canvas>
          </div>
          <div class="chartCard">
            <div class="chartTitle">Yearly Contribution vs Yearly Growth</div>
            <canvas id="barChart" width="580" height="170"></canvas>
          </div>
          <div class="chartCard">
            <div class="chartTitle">Deposit Step-up Trend</div>
            <canvas id="depositTrendChart" width="580" height="170"></canvas>
          </div>
          <div class="chartCard">
            <div class="chartTitle">Portfolio Mix at Maturity</div>
            <div class="donutWrap">
              <div class="donut" id="mixDonut"></div>
              <div class="legend">
                <div class="legendItem"><span><span class="dot" style="background:var(--lineB)"></span>Invested</span><strong id="donutInvested">Rs. 0.00</strong></div>
                <div class="legendItem"><span><span class="dot" style="background:var(--lineC)"></span>Returns</span><strong id="donutReturns">Rs. 0.00</strong></div>
                <div class="legendItem"><span>Returns share</span><strong id="returnShare">0%</strong></div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>

  <script>
    function formatINR(value) {
      return "Rs. " + new Intl.NumberFormat("en-IN", {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      }).format(value);
    }

    function getFrequencyConfig(freq) {
      switch (freq) {
        case "monthly": return { p: 1 };
        case "quarterly": return { p: 3 };
        case "halfYearly": return { p: 6 };
        case "yearly": return { p: 12 };
        default: return { p: 1 };
      }
    }

    function applyStepUp(value, stepUpValue, stepUpUnit) {
      if (stepUpUnit === "rupees") return value + stepUpValue;
      return value * (1 + stepUpValue / 100);
    }

    function buildProjection(params) {
      const monthlyRate = params.annualRate / 100 / 12;
      const points = [];
      const yearlyBars = [];
      const depositTrend = [];
      const freqStep = getFrequencyConfig(params.freq).p;

      let corpus = params.lumpSum;
      let invested = params.lumpSum;
      let depPerPeriod = params.depositPerPeriod;
      let yearDeposit = 0;
      let yearStartCorpus = corpus;

      points.push({ month: 0, invested, corpus });
      depositTrend.push({ year: 1, deposit: depPerPeriod });

      for (let m = 1; m <= params.totalMonths; m++) {
        if ((m - 1) % 12 === 0 && m > 1) {
          depPerPeriod = Math.max(0, applyStepUp(depPerPeriod, params.stepUpValue, params.stepUpUnit));
          depositTrend.push({ year: Math.floor((m - 1) / 12) + 1, deposit: depPerPeriod });
        }

        if ((m - 1) % freqStep === 0) {
          invested += depPerPeriod;
          corpus += depPerPeriod;
          yearDeposit += depPerPeriod;
        }

        corpus *= (1 + monthlyRate);
        points.push({ month: m, invested, corpus });

        if (m % 12 === 0 || m === params.totalMonths) {
          const gain = corpus - yearStartCorpus - yearDeposit;
          yearlyBars.push({ year: Math.ceil(m / 12), deposit: yearDeposit, gain: Math.max(0, gain) });
          yearDeposit = 0;
          yearStartCorpus = corpus;
        }
      }

      return { points, yearlyBars, depositTrend, corpus, invested, returns: corpus - invested };
    }

    function drawAxes(ctx, width, height, left, top, right, bottom) {
      ctx.strokeStyle = getComputedStyle(document.body).getPropertyValue("--chartGrid");
      ctx.lineWidth = 1;
      for (let i = 0; i <= 4; i++) {
        const y = top + ((height - top - bottom) * i / 4);
        ctx.beginPath();
        ctx.moveTo(left, y);
        ctx.lineTo(width - right, y);
        ctx.stroke();
      }
      ctx.beginPath();
      ctx.moveTo(left, top);
      ctx.lineTo(left, height - bottom);
      ctx.lineTo(width - right, height - bottom);
      ctx.stroke();
    }

    function drawLineGraph(canvasId, seriesA, seriesB) {
      const canvas = document.getElementById(canvasId);
      const ctx = canvas.getContext("2d");
      const w = canvas.width;
      const h = canvas.height;
      const pad = { l: 44, t: 14, r: 10, b: 24 };
      ctx.clearRect(0, 0, w, h);
      drawAxes(ctx, w, h, pad.l, pad.t, pad.r, pad.b);

      const maxVal = Math.max(...seriesA.map(p => p.y), ...seriesB.map(p => p.y), 1);
      const maxX = Math.max(seriesA[seriesA.length - 1].x, 1);

      function mapX(x){ return pad.l + (x / maxX) * (w - pad.l - pad.r); }
      function mapY(y){ return h - pad.b - (y / maxVal) * (h - pad.t - pad.b); }

      ctx.strokeStyle = getComputedStyle(document.body).getPropertyValue("--lineB");
      ctx.lineWidth = 2.2;
      ctx.beginPath();
      seriesA.forEach((p, i) => i === 0 ? ctx.moveTo(mapX(p.x), mapY(p.y)) : ctx.lineTo(mapX(p.x), mapY(p.y)));
      ctx.stroke();

      ctx.strokeStyle = getComputedStyle(document.body).getPropertyValue("--lineA");
      ctx.beginPath();
      seriesB.forEach((p, i) => i === 0 ? ctx.moveTo(mapX(p.x), mapY(p.y)) : ctx.lineTo(mapX(p.x), mapY(p.y)));
      ctx.stroke();

      ctx.fillStyle = getComputedStyle(document.body).getPropertyValue("--muted");
      ctx.font = "11px Inter, system-ui";
      ctx.fillText("Invested", w - 150, 14);
      ctx.fillStyle = getComputedStyle(document.body).getPropertyValue("--lineB");
      ctx.fillRect(w - 206, 6, 12, 2);
      ctx.fillStyle = getComputedStyle(document.body).getPropertyValue("--muted");
      ctx.fillText("Portfolio", w - 76, 14);
      ctx.fillStyle = getComputedStyle(document.body).getPropertyValue("--lineA");
      ctx.fillRect(w - 134, 6, 12, 2);
    }

    function drawBars(canvasId, bars) {
      const canvas = document.getElementById(canvasId);
      const ctx = canvas.getContext("2d");
      const w = canvas.width;
      const h = canvas.height;
      const pad = { l: 40, t: 14, r: 10, b: 26 };
      ctx.clearRect(0, 0, w, h);
      drawAxes(ctx, w, h, pad.l, pad.t, pad.r, pad.b);

      const maxVal = Math.max(...bars.map(b => Math.max(b.deposit, b.gain)), 1);
      const plotW = w - pad.l - pad.r;
      const slot = plotW / Math.max(bars.length, 1);

      bars.forEach((b, i) => {
        const x = pad.l + i * slot + slot * 0.18;
        const barW = slot * 0.26;
        const yDep = h - pad.b - (b.deposit / maxVal) * (h - pad.t - pad.b);
        const yGain = h - pad.b - (b.gain / maxVal) * (h - pad.t - pad.b);
        ctx.fillStyle = getComputedStyle(document.body).getPropertyValue("--lineD");
        ctx.fillRect(x, yDep, barW, h - pad.b - yDep);
        ctx.fillStyle = getComputedStyle(document.body).getPropertyValue("--lineC");
        ctx.fillRect(x + barW + 3, yGain, barW, h - pad.b - yGain);
      });

      ctx.fillStyle = getComputedStyle(document.body).getPropertyValue("--muted");
      ctx.font = "11px Inter, system-ui";
      ctx.fillText("Deposit", w - 145, 14);
      ctx.fillStyle = getComputedStyle(document.body).getPropertyValue("--lineD");
      ctx.fillRect(w - 194, 6, 10, 10);
      ctx.fillStyle = getComputedStyle(document.body).getPropertyValue("--muted");
      ctx.fillText("Growth", w - 68, 14);
      ctx.fillStyle = getComputedStyle(document.body).getPropertyValue("--lineC");
      ctx.fillRect(w - 117, 6, 10, 10);
    }

    function drawDepositTrend(canvasId, values) {
      const canvas = document.getElementById(canvasId);
      const ctx = canvas.getContext("2d");
      const w = canvas.width;
      const h = canvas.height;
      const pad = { l: 40, t: 14, r: 10, b: 24 };
      ctx.clearRect(0, 0, w, h);
      drawAxes(ctx, w, h, pad.l, pad.t, pad.r, pad.b);

      const maxVal = Math.max(...values.map(v => v.deposit), 1);
      const maxX = Math.max(values.length - 1, 1);
      function mapX(x){ return pad.l + (x / maxX) * (w - pad.l - pad.r); }
      function mapY(y){ return h - pad.b - (y / maxVal) * (h - pad.t - pad.b); }

      ctx.strokeStyle = getComputedStyle(document.body).getPropertyValue("--lineA");
      ctx.lineWidth = 2.4;
      ctx.beginPath();
      values.forEach((p, i) => i === 0 ? ctx.moveTo(mapX(i), mapY(p.deposit)) : ctx.lineTo(mapX(i), mapY(p.deposit)));
      ctx.stroke();

      ctx.fillStyle = getComputedStyle(document.body).getPropertyValue("--lineA");
      values.forEach((p, i) => {
        ctx.beginPath();
        ctx.arc(mapX(i), mapY(p.deposit), 2.8, 0, Math.PI * 2);
        ctx.fill();
      });
    }

    function updateDonut(invested, returns) {
      const donut = document.getElementById("mixDonut");
      const total = Math.max(invested + returns, 1);
      const investDeg = (invested / total) * 360;
      donut.style.background = `conic-gradient(var(--lineB) 0deg, var(--lineB) ${investDeg}deg, var(--lineC) ${investDeg}deg 360deg)`;
      document.getElementById("donutInvested").textContent = formatINR(invested);
      document.getElementById("donutReturns").textContent = formatINR(returns);
      document.getElementById("returnShare").textContent = ((returns / total) * 100).toFixed(1) + "%";
    }

    function avgRemainingMonthsFullYear(n, p) {
      return 12 - (p * (n - 1) / 2);
    }

    function depositCountPartial(remMonths, p) {
      if (remMonths <= 0) return 0;
      return Math.floor((remMonths - 1) / p) + 1;
    }

    function initTheme() {
      const stored = localStorage.getItem("sip-theme");
      const isDark = stored === "dark";
      document.body.classList.toggle("dark", isDark);
      updateThemeToggle(isDark);
    }

    function renderCharts(projection) {
      const investedSeries = projection.points.map(p => ({ x: p.month, y: p.invested }));
      const corpusSeries = projection.points.map(p => ({ x: p.month, y: p.corpus }));
      drawLineGraph("lineChart", investedSeries, corpusSeries);
      drawBars("barChart", projection.yearlyBars.slice(0, 12));
      drawDepositTrend("depositTrendChart", projection.depositTrend.slice(0, 20));
      updateDonut(projection.invested, projection.returns);
    }


    function updateThemeToggle(isDark) {
      document.getElementById("themeIcon").textContent = isDark ? "‚òÄÔ∏è" : "üåô";
      document.getElementById("themeLabel").textContent = isDark ? "Light mode" : "Dark mode";
    }

    function toggleTheme() {
      const isDark = document.body.classList.toggle("dark");
      localStorage.setItem("sip-theme", isDark ? "dark" : "light");
      updateThemeToggle(isDark);
    }

    function initTheme() {
      const stored = localStorage.getItem("sip-theme");
      const isDark = stored === "dark";
      document.body.classList.toggle("dark", isDark);
      updateThemeToggle(isDark);
    }

    function calculateSIP() {
      const lumpSum = parseFloat(document.getElementById("lumpSum").value) || 0;
      const depositPerPeriod = parseFloat(document.getElementById("depositAmount").value) || 0;
      const freq = document.getElementById("depositFreq").value;
      const stepUpValue = parseFloat(document.getElementById("stepUpValue").value) || 0;
      const stepUpUnit = document.getElementById("stepUpUnit").value;
      const termValue = parseInt(document.getElementById("termValue").value) || 0;
      const termUnit = document.getElementById("termUnit").value;
      const annualRate = parseFloat(document.getElementById("rate").value) || 0;

      if (annualRate <= 0 || termValue <= 0 || depositPerPeriod <= 0) {
        alert("Please enter Regular Deposit Amount, Expected Return (%), and Term.");
        return;
      }

      const { n, p } = getFrequencyConfig(freq);
      const r = annualRate / 100;

      const totalMonths = (termUnit === "years") ? (termValue * 12) : termValue;
      const fullYears = Math.floor(totalMonths / 12);
      const remMonths = totalMonths % 12;

      let totalDeposits = lumpSum;
      let depPerPeriod = depositPerPeriod0;

      for (let y = 0; y < fullYears; y++) {
        totalDeposits += depPerPeriod * n;
        depPerPeriod = applyStepUp(depPerPeriod, stepUpValue, stepUpUnit);
      }
      if (remMonths > 0) {
        const cnt = depositCountPartial(remMonths, p);
        totalDeposits += depPerPeriod * cnt;
      }

      let corpus = lumpSum;
      depPerPeriod = depositPerPeriod0;

      for (let y = 0; y < fullYears; y++) {
        corpus *= (1 + r);

        const avgMonths = avgRemainingMonthsFullYear(n, p);
        const yearDeposit = depPerPeriod * n;
        corpus += yearDeposit * (1 + r * (avgMonths / 12));

        depPerPeriod = applyStepUp(depPerPeriod, stepUpValue, stepUpUnit);
      }

      if (remMonths > 0) {
        corpus *= (1 + r * (remMonths / 12));

        const cnt = depositCountPartial(remMonths, p);
        const avgRem = avgRemainingMonthsPartial(remMonths, p);
        const partDeposit = depPerPeriod * cnt;
        corpus += partDeposit * (1 + r * (avgRem / 12));
      }

      const totalReturns = corpus - totalDeposits;

      document.getElementById("result").classList.remove("hidden");
      document.getElementById("emptyState").classList.add("hidden");

      document.getElementById("maturityText").textContent = formatINR(corpus);
      document.getElementById("depositText").textContent = formatINR(totalDeposits);
      document.getElementById("returnsText").textContent = formatINR(totalReturns);
      document.getElementById("investedHint").textContent = "Total invested: " + formatINR(totalDeposits);
    }

    initTheme();

    function resetForm() {
      document.getElementById("lumpSum").value = 0;
      document.getElementById("depositAmount").value = "";
      document.getElementById("depositFreq").value = "monthly";
      document.getElementById("stepUpValue").value = 0;
      document.getElementById("stepUpUnit").value = "percent";
      document.getElementById("termValue").value = "";
      document.getElementById("termUnit").value = "years";
      document.getElementById("rate").value = "";
      window.lastProjection = null;
      document.getElementById("maturityText").textContent = "Rs. 0.00";
      document.getElementById("depositText").textContent = "Rs. 0.00";
      document.getElementById("returnsText").textContent = "Rs. 0.00";
      document.getElementById("investedHint").textContent = "Total invested: Rs. 0.00";
      updateDonut(0, 0);
      drawLineGraph("lineChart", [{x:0,y:0},{x:1,y:0}], [{x:0,y:0},{x:1,y:0}]);
      drawBars("barChart", [{year:1,deposit:0,gain:0}]);
      drawDepositTrend("depositTrendChart", [{year:1,deposit:0},{year:2,deposit:0}]);
    }

    initTheme();
    resetForm();
  </script>
</body>
</html>
